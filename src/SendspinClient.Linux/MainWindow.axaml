<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="using:SendspinClient.Linux.ViewModels"
        mc:Ignorable="d"
        d:DesignWidth="420"
        d:DesignHeight="560"
        x:Class="SendspinClient.Linux.MainWindow"
        x:DataType="vm:MainViewModel"
        Title="Sendspin"
        Width="420"
        Height="560"
        MinWidth="380"
        MinHeight="480"
        WindowStartupLocation="CenterScreen"
        CanResize="True"
        Background="Transparent">

    <Design.DataContext>
        <vm:MainViewModel />
    </Design.DataContext>

    <!-- Root: Layered composition for frosted glass effect -->
    <Panel>

        <!-- ═══════════════════════════════════════════════════════════════════
             LAYER 1: Background
             ═══════════════════════════════════════════════════════════════════ -->

        <!-- Blurred Album Art Background (when artwork available) -->
        <Image Source="{Binding AlbumArtwork}"
               Stretch="UniformToFill"
               Effect="blur(40)"
               IsVisible="{Binding AlbumArtwork, Converter={x:Static ObjectConverters.IsNotNull}}" />

        <!-- Dark gradient fallback (when no artwork) -->
        <Border Background="{StaticResource WindowBackgroundBrush}"
                IsVisible="{Binding AlbumArtwork, Converter={x:Static ObjectConverters.IsNull}}" />

        <!-- ═══════════════════════════════════════════════════════════════════
             LAYER 2: Dark overlay for text readability
             ═══════════════════════════════════════════════════════════════════ -->
        <Border Background="{StaticResource GlassDarkBrush}"
                IsVisible="{Binding AlbumArtwork, Converter={x:Static ObjectConverters.IsNotNull}}" />

        <!-- ═══════════════════════════════════════════════════════════════════
             LAYER 3: Main Content
             ═══════════════════════════════════════════════════════════════════ -->
        <Grid RowDefinitions="Auto,*,Auto">

            <!-- ═══════════════════════════════════════════════════════════════════
                 HEADER - Server Connection Status (Frosted Glass)
                 ═══════════════════════════════════════════════════════════════════ -->
            <Border Grid.Row="0"
                    Background="{StaticResource GlassLightBrush}"
                    Padding="20,16">
                <Grid ColumnDefinitions="*,Auto">

                    <!-- Server Selection / Status -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                Spacing="12"
                                VerticalAlignment="Center">

                        <!-- Status Indicator -->
                        <Grid Width="8" Height="8">
                            <!-- Connected -->
                            <Ellipse Classes="status-dot connected"
                                     IsVisible="{Binding IsConnected}" />
                            <!-- Disconnected -->
                            <Ellipse Classes="status-dot disconnected"
                                     IsVisible="{Binding !IsConnected}" />
                        </Grid>

                        <!-- Server Dropdown (Disconnected) -->
                        <ComboBox Classes="server-select"
                                  ItemsSource="{Binding DiscoveredServers}"
                                  SelectedItem="{Binding SelectedServer}"
                                  IsVisible="{Binding !IsConnected}"
                                  MinWidth="200"
                                  PlaceholderText="Select a server...">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding Name}"
                                               Foreground="{StaticResource TextPrimaryBrush}" />
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                        </ComboBox>

                        <!-- Server Name (Connected) -->
                        <TextBlock Text="{Binding ServerName}"
                                   Classes="status"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   IsVisible="{Binding IsConnected}"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Connect/Disconnect Button -->
                    <Button Grid.Column="1"
                            Classes="pill accent"
                            Command="{Binding ConnectCommand}"
                            Content="Connect"
                            IsVisible="{Binding !IsConnected}" />

                    <Button Grid.Column="1"
                            Classes="pill"
                            Command="{Binding DisconnectCommand}"
                            Content="Disconnect"
                            IsVisible="{Binding IsConnected}" />
                </Grid>
            </Border>

            <!-- ═══════════════════════════════════════════════════════════════════
                 MAIN CONTENT - Album Art & Track Info
                 ═══════════════════════════════════════════════════════════════════ -->
            <Grid Grid.Row="1"
                  Margin="24,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Album Art / Vinyl Disc Container -->
                <Viewbox Grid.Row="0"
                         Stretch="Uniform"
                         MaxWidth="320"
                         MaxHeight="320"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Center"
                         Margin="0,16">

                    <Grid Width="320" Height="320">

                        <!-- Sharp Album Art with shadow (when artwork available) -->
                        <Border CornerRadius="12"
                                ClipToBounds="True"
                                BoxShadow="0 8 32 0 #60000000"
                                IsVisible="{Binding AlbumArtwork, Converter={x:Static ObjectConverters.IsNotNull}}">
                            <Image Source="{Binding AlbumArtwork}"
                                   Stretch="UniformToFill"
                                   Width="320"
                                   Height="320" />
                        </Border>

                        <!-- Vinyl Disc Fallback (when no artwork) -->
                        <Grid Width="280" Height="280"
                              HorizontalAlignment="Center"
                              VerticalAlignment="Center"
                              IsVisible="{Binding AlbumArtwork, Converter={x:Static ObjectConverters.IsNull}}">

                            <!-- Outer Ring - Glow when playing -->
                            <Ellipse Width="280" Height="280"
                                     StrokeThickness="2"
                                     Stroke="{StaticResource BackgroundSurfaceBrush}">
                                <Ellipse.Styles>
                                    <Style Selector="Ellipse">
                                        <Setter Property="Opacity" Value="0.3" />
                                    </Style>
                                </Ellipse.Styles>
                            </Ellipse>

                            <!-- Main Disc Body -->
                            <Ellipse Width="260" Height="260"
                                     Fill="{StaticResource BackgroundSurfaceBrush}"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />

                            <!-- Vinyl Grooves - Concentric circles -->
                            <Ellipse Width="240" Height="240"
                                     StrokeThickness="0.5"
                                     Stroke="{StaticResource TextDisabledBrush}"
                                     Fill="Transparent"
                                     Opacity="0.3"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />
                            <Ellipse Width="200" Height="200"
                                     StrokeThickness="0.5"
                                     Stroke="{StaticResource TextDisabledBrush}"
                                     Fill="Transparent"
                                     Opacity="0.25"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />
                            <Ellipse Width="160" Height="160"
                                     StrokeThickness="0.5"
                                     Stroke="{StaticResource TextDisabledBrush}"
                                     Fill="Transparent"
                                     Opacity="0.2"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />
                            <Ellipse Width="120" Height="120"
                                     StrokeThickness="0.5"
                                     Stroke="{StaticResource TextDisabledBrush}"
                                     Fill="Transparent"
                                     Opacity="0.15"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />

                            <!-- Center Label Area -->
                            <Ellipse Width="90" Height="90"
                                     Fill="{StaticResource BackgroundElevatedBrush}"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />

                            <!-- Center Spindle -->
                            <Ellipse Width="12" Height="12"
                                     Fill="{StaticResource BackgroundDeepBrush}"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center" />

                            <!-- Playing Indicator - Accent ring when playing -->
                            <Ellipse Width="92" Height="92"
                                     StrokeThickness="1.5"
                                     Stroke="{StaticResource AccentPrimaryBrush}"
                                     Fill="Transparent"
                                     Opacity="0.8"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center"
                                     IsVisible="{Binding IsConnected}">
                                <Ellipse.Styles>
                                    <Style Selector="Ellipse">
                                        <Setter Property="Opacity" Value="0" />
                                    </Style>
                                    <Style Selector="Ellipse:not(.paused)">
                                        <Setter Property="Opacity" Value="0.8" />
                                    </Style>
                                </Ellipse.Styles>
                            </Ellipse>
                        </Grid>
                    </Grid>
                </Viewbox>

                <!-- Track Information -->
                <StackPanel Grid.Row="1"
                            HorizontalAlignment="Center"
                            Spacing="6"
                            Margin="0,8,0,0">

                    <!-- Track Title -->
                    <TextBlock Classes="track-title"
                               Text="{Binding TrackTitle}"
                               HorizontalAlignment="Center"
                               MaxWidth="360"
                               TextAlignment="Center" />

                    <!-- Artist -->
                    <TextBlock Classes="track-artist"
                               Text="{Binding Artist}"
                               HorizontalAlignment="Center"
                               MaxWidth="360"
                               TextAlignment="Center"
                               IsVisible="{Binding Artist, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                    <!-- Album -->
                    <TextBlock Classes="track-album"
                               Text="{Binding Album}"
                               HorizontalAlignment="Center"
                               MaxWidth="360"
                               TextAlignment="Center"
                               IsVisible="{Binding Album, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                </StackPanel>

                <!-- Transport Controls -->
                <StackPanel Grid.Row="2"
                            Orientation="Horizontal"
                            HorizontalAlignment="Center"
                            Spacing="16"
                            Margin="0,24,0,16">

                    <!-- Play/Pause Button -->
                    <Button Classes="transport"
                            Command="{Binding PlayPauseCommand}"
                            IsEnabled="{Binding IsConnected}"
                            ToolTip.Tip="{Binding PlayPauseButtonText}">
                        <Panel>
                            <!-- Play Icon (shown when paused) -->
                            <Path Data="M8,5.14V19.14L19,12.14L8,5.14Z"
                                  Fill="{StaticResource BackgroundDeepBrush}"
                                  Stretch="Uniform"
                                  Width="22"
                                  Height="22"
                                  IsVisible="{Binding IsPaused}" />
                            <!-- Pause Icon (shown when playing) -->
                            <Path Data="M14,19H18V5H14M6,19H10V5H6V19Z"
                                  Fill="{StaticResource BackgroundDeepBrush}"
                                  Stretch="Uniform"
                                  Width="20"
                                  Height="20"
                                  IsVisible="{Binding !IsPaused}" />
                        </Panel>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- ═══════════════════════════════════════════════════════════════════
                 FOOTER - Volume Control (Frosted Glass)
                 ═══════════════════════════════════════════════════════════════════ -->
            <Border Grid.Row="2"
                    Background="{StaticResource GlassMediumBrush}"
                    CornerRadius="16,16,0,0"
                    Padding="24,16,24,20">

                <Grid ColumnDefinitions="Auto,*,Auto"
                      VerticalAlignment="Center">

                    <!-- Volume Icon -->
                    <Path Grid.Column="0"
                          Data="M3,9H7L12,4V20L7,15H3V9M14,11A3,3 0 0,1 17,14A3,3 0 0,1 14,17V15A1,1 0 0,0 15,14A1,1 0 0,0 14,13M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23Z"
                          Fill="{StaticResource TextMutedBrush}"
                          Stretch="Uniform"
                          Width="18"
                          Height="18"
                          VerticalAlignment="Center"
                          Margin="0,0,12,0" />

                    <!-- Volume Slider -->
                    <Slider Grid.Column="1"
                            Classes="volume"
                            Minimum="0"
                            Maximum="100"
                            Value="{Binding Volume}"
                            VerticalAlignment="Center"
                            IsEnabled="{Binding IsConnected}" />

                    <!-- Volume Percentage -->
                    <TextBlock Grid.Column="2"
                               Text="{Binding Volume, StringFormat={}{0:F0}}"
                               Foreground="{StaticResource TextMutedBrush}"
                               FontSize="{StaticResource FontSizeSm}"
                               VerticalAlignment="Center"
                               Margin="12,0,0,0"
                               MinWidth="24"
                               TextAlignment="Right" />
                </Grid>
            </Border>
        </Grid>
    </Panel>

</Window>
